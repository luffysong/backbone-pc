/**
 * @project yinyuetai_pc_live_video
 * @description 音悦台直播PC版
 * @version v1.0.0
 * @time 2016-4-6   14:46:58
 * @author YYT
 * @copy http://www.yinyuetai.com
 */
webpackJsonp([5],{0:function(n,e,t){$(function(){"use strict";var n=t(64);new n;var e=t(130);new e,t(129)})},17:function(n,e,t){"use strict";var o=t(18),i=o.sharedInstanceIMModel(),r=t(20),a={setting:{listeners:{onMsgNotify:null,onGroupInfoChangeNotify:null,groupSystemNotifys:null}}};a.init=function(n){var e=this;i.fetchIMUserSig(function(t){e.im=t;var o={sdkAppID:t.imAppid,appIDAt3rd:t.imAppid,accountType:t.imAccountType,identifier:t.imIdentifier,userSig:t.userSig};t&&n&&webim.init(o,n,null)},function(n){})},a.sendMessage=function(n,e,t){var o=Math.floor(1e4*Math.random()),i=new webim.Session("GROUP",n.groupId,n.groupId,"",o);if(i){var r=new webim.Msg(i,!0);r.addText(new webim.Msg.Elem.Text(JSON.stringify(n.msg))),r.fromAccount=this.im.imIdentifier,webim.sendMsg(r,function(n){e&&e(n)},function(n){t&&t(n)})}},a.clearScreen=function(n){this.sendMessage(n)},a.lockScreen=function(){},a.disableSendMsg=function(n,e,t){var o=webim.Tool.formatTimeStamp(Math.round((new Date).getTime()/1e3)+600);o=new Date(o+"").getTime(),n=_.extend({ShutUpTime:o},n),webim.forbidSendMsg(n,function(n){e&&e(n)},function(n){t&&t(n)})},a.removeUserFromGroup=function(n,e,t){(!n||!n.GroupId||n.MemberToDel_Account.length<=0)&&t&&t({msg:"参数不正确"}),webim.deleteGroupMember(n,function(n){e&&e(n)},function(n){t&&t(n)})},a.msgNotify=function(n){},a.getRoomMsgs=function(n){for(var e=[],t=1;;){if(t++>20)break;e.push({name:"Aaron-"+t,msg:"asdfasdfasfjaslfjasklfasdklf"+t})}n&&n.call(this,e)},a.createIMChatRoom=function(n,e){var t=r.get("imSig"),o={Owner_Account:t.imIdentifier,Type:"ChatRoom",Name:"测试聊天室",Notification:"",Introduction:"",MemberList:[]};webim.createGroup(o,function(e){n&&n(e)},function(n){e&&e(n)})},a.applyJoinGroup=function(n,e,t){var o={GroupId:n,ApplyMsg:"直播间",UserDefinedField:""};webim.applyJoinGroup(o,function(n){e&&e(n)},function(n){t&&t(n)})},a.getGroupInfo=function(n,e,t){var o={GroupIdList:[n],GroupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption"],MemberInfoFilter:["Account","Role","JoinTime","LastSendMsgTime","ShutUpUntil"]};webim.getGroupInfo(o,function(n){e&&e(n)},function(n){t&&t(n)})},a.modifyGroupInfo=function(n,e,t){webim.modifyGroupBaseInfo(n,function(n){e&&e(n)},function(n){t&&t(n)})},n.exports=a},34:function(n,e,t){"use strict";var o=t(19),i=null,r=o.extend({url:"{{url_prefix}}/room/detail.json?deviceinfo={{deviceinfo}}&access_token=web-{{accessToken}}&roomId={{roomId}}",beforeEmit:function(n){}});r.sigleInstance=function(){return i||(i=new r),i},n.exports=r},35:function(n,e,t){"use strict";var o=t(19),i=null,r=o.extend({url:"{{url_prefix}}/room/longpolling.json",beforeEmit:function(n){}});r.sigleInstance=function(){return i||(i=new r),i},n.exports=r},36:function(n,e,t){var o={},i={title:"消息",content:"",okFn:null,cancelFn:null,okBtn:!0,cancelBtn:!0};o.init=function(n){var e=_.template(this.getHTML()),t=e(n);this.remove(),this.bindEvent(t,n.okFn,n.cancelFn)},o.remove=function(){var n=$("#UIConfigWrap");n&&n.length>=1&&n.remove()},o.getHTML=function(){return t(37)},o.bindEvent=function(n,e,t){var o=this;n=$(n),n.find("#UIConfirmOk").on("click",function(n){return n.preventDefault(),e&&e(),o.remove(),!1}),n.find(".UIConfirmClose").on("click",function(n){return n.preventDefault(),t&&t(),o.remove(),!1}),n.find("#UIConfirmOk").on("click",function(n){return n.preventDefault(),o.remove(),!1}),$("body").append(n)},o.show=function(n){var e=_.extend(i,n);this.init(e)},o.close=function(){this.remove()},n.exports={show:function(n){o.show(n)},close:function(){o.close()}}},37:function(n,e){n.exports='<div id="UIConfigWrap" class="shadow_screen">\n    <div class="shadow"></div>\n    <div class="edit_annmoucement_con" style="margin-bottom: 16px; width: 400px;margin-left:-200px;">\n        <h2 class="edit_title"><span id="UIConfirmTitle"><%=title%></span> <span class="close UIConfirmClose">X</span></h2>\n        <div class="editCon" style="">\n            <div class="content" style="padding:16px; font-size: 14px;"><%=content%></div>\n            <p class="btn-wrap" style="">\n                <a style="display: <%= cancelBtn?\'inline-block\':\'none\'%>;" href="javascript:;" class="cancel UIConfirmClose">取消</a>\n                <a id="UIConfirmOk" href="javascript:;" class="submit">确定</a>\n            </p>\n        </div>\n    </div>\n</div>'},52:function(n,e,t){(function(e){"use strict";!function(t){"object"==typeof self&&self.self==self&&self||"object"==typeof e&&e.global==e&&e;n.exports=t()}(function(){var n=function(n){this.temp=new Date,this.setCurNewDate(n)};n.prototype.changeYear=function(n){this.temp.setFullYear(n)},n.prototype.getCountDays=function(n){return this.temp.setMonth(n),this.temp.setDate(0),this.temp.getDate()},n.prototype.$get=function(n){return this.attrs[n]},n.prototype.ceilYear=function(n){n=~~n;for(var e=0,t=this.$get("year"),o=[];n>=e;e++)o.push(t),t+=1;return o},n.prototype._downDisplacement=function(n){var e,t=this.$get(n),o=[];switch(n){case"month":e=12;break;case"day":e=this.getCountDays(this.$get("month"));break;case"hours":e=23;break;default:e=59}for(;e>=t;t++)o.push(t);return o},n.prototype.downMonth=function(){return this._downDisplacement("month")},n.prototype.downDay=function(){return this._downDisplacement("day")},n.prototype.downHours=function(){return this._downDisplacement("hours")},n.prototype.downMinutes=function(){return this._downDisplacement("minutes")},n.prototype.down=function(n){return this._downDisplacement(n)},n.prototype.getTime=function(n){var e="",t=n.month<10?"0"+n.month:n.month,o=n.day<10?"0"+n.day:n.day,i=n.hours<10?"0"+n.hours:n.hours,r=n.minutes<10?"0"+n.minutes:n.minutes;return e+=n.year+"-"+t+"-"+o+" ",e+=i+":"+r+":00",new Date(e.replace(/-/g,"/")).getTime()},n.prototype.setCurNewDate=function(n){this.date=null,this.date=n?new Date(n):new Date,this._setAttrs()},n.prototype._setAttrs=function(){this.attrs=null,this.attrs={year:this.date.getFullYear(),month:this.date.getMonth()+1,day:this.date.getDate(),hours:this.date.getHours(),minutes:this.date.getMinutes()}},n.difference=function(n){var e={},t=n%864e5,o=Math.floor(t/36e5);e.hours=10>o?"0"+o:o;var i=t%36e5,r=Math.floor(i/6e4);e.minutes=10>r?"0"+r:r;var a=i%6e4,s=Math.floor(a/1e3);return e.seconds=10>s?"0"+s:s,e};var e=null;return n.sharedInstanceDateTime=function(){return e||(e=new n),e},n}),Date.prototype.Format=function(n){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in e)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,1==RegExp.$1.length?e[t]:("00"+e[t]).substr((""+e[t]).length)));return n}}).call(e,function(){return this}())},58:function(n,e,t){"use strict";var o=t(19),i=o.extend({url:"{{url_prefix}}/room/placard_get.json?deviceinfo={{deviceinfo}}&access_token=web-{{accessToken}}&roomId={{roomId}}",beforeEmit:function(n){}});n.exports=i},115:function(n,e,t){"use strict";var o=t(19),i=null,r=o.extend({url:"{{url_prefix}}/user/info.json",beforeEmit:function(n){}});r.sigleInstance=function(){return i||(i=new r),i},n.exports=r},116:function(n,e,t){function o(){}var i,r=t(115),a=t(20),s=(t(52),t(22)),c=s.sharedInstanceUserModel(),u=null;o.prototype.getInfo=function(n,e){this.anchorInfoModel=r.sigleInstance(),this.anchorInfoParams={deviceinfo:'{"aid": "30001001"}',access_token:"web-"+c.getToken()},this.anchorInfoModel.executeJSONP(this.anchorInfoParams,function(e){e&&"SUCCESS"===e.msg&&(n&&n(e.data),i=e.data)},function(n){e&&e(n)})},u=new o,n.exports={getInfo:function(n,e){return i?void(n&&n(i)):void u.getInfo(n,e)},isDisbaleTalk:function(){var n=a.get("userDisableTalkTime");if(!n)return!1;n=new Date(n);var e=new Date,t=e.getTime()-n.getTime();return 0>=t},isKickout:function(n){var e=a.get("userKickout");if(!e)return!1;e=JSON.parse(e);var t=_.find(e,function(e){return e.roomId==n});return!!t&&t.isKickout},setDisableTalk:function(n){n&&a.set("userDisableTalkTime",n)},setKickout:function(n,e){var t=a.get("userKickout");t=t?JSON.parse(t):[];var o=_.find(t,function(e){return e.roomId==n});o?o.isKickout=e:t.push({roomId:n,isKickout:e}),a.set("userKickout",JSON.stringify(t))},setLockScreen:function(n,e){var t=a.get("isLockScreen");t=t?JSON.parse(t):[];var o=_.find(t,function(e){return e.roomId==n});o?o.isLock=e:t.push({roomId:n,isLock:e}),a.set("isLockScreen",JSON.stringify(t))},isLockScreen:function(n){var e=a.get("isLockScreen");if(!e)return!1;e=JSON.parse(e);var t=_.find(e,function(e){return e.roomId==n});return!!t&&t.isLock}}},117:function(n,e,t){"use strict";var o=t(11),i=o.extend({el:"#edit_background",rawLoader:function(){return t(118)},events:{},beforeMount:function(){this.elements={}},afterMount:function(){var n=this.$el;this.elements.roomName=n.find(".room-name"),this.elements={roomName:n.find(".room-name"),onLine:n.find("#onlineCount"),popularity:n.find("#popularityCount")}},ready:function(){this.defineEventInterface()},defineEventInterface:function(){var n=this;Backbone.on("event:roomInfoReady",function(e){e&&n.bindData(e)}),Backbone.on("event:updateRoomInfo",function(e){e&&(n.elements.onLine.text(e.currentOnline||0),n.elements.popularity.text(e.popularity||0))})},bindData:function(n){var e=this.elements;e.roomName.text(n.roomName||""),e.onLine.text(n.online||0),e.popularity.text(n.popularity||0)}});n.exports=i},118:function(n,e){n.exports='<div class="room-name fl">xx</div>\n<div class="room-title-right fr">\n  <span class="online">在线人数:<span class="red count font-yahei" id="onlineCount">0</span></span>\n  <span class="popularity">人气:<span class="green count font-yahei" id="popularityCount">0</span></span>\n  <!--<button class="btn Hand btn-support boderRadAll_3"><i></i> 顶一下</button>-->\n</div>\n\n'},123:function(n,e,t){"use strict";var o=t(11),i=t(58),r=t(22),a=r.sharedInstanceUserModel(),s=o.extend({el:"#userInfoWrap",rawLoader:function(){return t(124)},events:{},beforeMount:function(){this.elements={}},afterMount:function(){var n=this.$el;this.noticeGetModel=new i,this.tagTpl=this.$el.find("#tagTpl").html(),this.elements={anchorAvatar:n.find("#anchorAvatar"),name:n.find("#anchorName"),btnAdd:n.find("#btnAdd"),btnReport:n.find("#btnReport"),tagsWrap:n.find("#tagsWrap"),noticeWrap:n.find("#noticWrap")},this.noticeGetParams={deviceinfo:'{"aid":"30001001"}',roomId:"",access_token:"web-"+a.getToken()}},ready:function(){this.defineEventInterface()},defineEventInterface:function(){var n=this;Backbone.on("event:roomInfoReady",function(e){e&&(n.roomInfo=e,n.bindData(e),n.getNoticeInfo())}),Backbone.on("event:updateRoomInfo",function(n){}),Backbone.on("event:updateRoomNotice",function(e){e&&n.elements.noticeWrap.text(e.content||"暂无公告")})},bindData:function(n){var e=this.elements;e.anchorAvatar.attr("src",n.creator.largeAvatar),e.name.text(n.creator.nickName);var t=_.template(this.tagTpl);e.tagsWrap.html(t(n.creator))},getNoticeInfo:function(){var n=this;this.noticeGetParams.roomId=this.roomInfo.id,this.noticeGetModel.executeJSONP(this.noticeGetParams,function(e){if(e&&e.data){var t=null;e.data.placards&&(t=e.data.placards[0]),t?n.elements.noticeWrap.text(t.content||"暂无公告"):n.elements.noticeWrap.text("暂无公告")}},function(n){msgBox.showError(n.msg||"获取公告失败")})}});n.exports=s},124:function(n,e){n.exports='<div class="user-info-wrap clearfix">\n    <img id="anchorAvatar" class="Left avator boderRadAll_35"\n         src="http://img1.yytcdn.com/user/avatar/160322/703-1458640483613/-M-216abfaf3d4ae2ee4d194029b70cdc9d_100x100.jpg"\n         alt="">\n    <div class="info Left">\n        <div id="anchorName" class="name overflow_ellipsis">撒旦法是否是是法撒旦法</div>\n        <div class="btn-wrap mTop10">\n            <!--<button class="btn Hand " id="btnAdd"><i class="add Left"></i> 加关注</button>-->\n            <!--<button class="btn Hand mLeft5" id="btnReport"><i class="Left report"></i> 举报</button>-->\n            <div class="Clear"></div>\n        </div>\n    </div>\n</div>\n<div class="tags mTop10">\n    <div class="gary1 Left">标签:</div>\n    <div class="Right" id="tagsWrap">\n        <script type="text/template" id="tagTpl">\n            <%\n                for(var i=0,l=tags.length; i < l; i++) {\n            %>\n            <span class="item"><%=tags[i]%></span>\n            <%\n            }\n            %>\n        </script>\n    </div>\n    <div class="Clear"></div>\n</div>\n<div class="room-notice mTop10 boderRadAll_5">\n    <i class="trumpet mLeft5 Left"></i>\n    <div id="noticWrap" class="gary2 WordBreak notice mLeft30"></div>\n    <div class="Clear"></div>\n</div>\n'},125:function(n,e,t){"use strict";var o=t(11),i=t(126),r=t(22),a=r.sharedInstanceUserModel(),s=o.extend({clientRender:!1,el:"#anchorPlayedList",events:{},beforeMount:function(){},afterMount:function(){var n=this.$el;this.anchorPlayedTpl=n.find("#anchorPlayedTpl").html(),this.playedList=n.find("#playedListWrap"),this.playedListModel=i.sigleInstance(),this.playedListParams={deviceinfo:'{"aid":"30001001"}',access_token:"web-"+a.getToken(),anchor:"",order:"time",offset:0,size:3}},ready:function(){this.defineEventInterface()},defineEventInterface:function(){var n=this;Backbone.on("event:roomInfoReady",function(e){e&&(n.roomInfo=e,n.bindData(e.creator.uid))})},initCarousel:function(){var n=$("#palyedJcarousel"),e=n.find(".jcarousel");e.on("jcarousel:reload jcarousel:create",function(){var n=$(this),e=n.innerWidth();e>=600?e/=3:e>=350&&(e/=2),n.jcarousel("items").css("width",Math.ceil(e)+"px")}).jcarousel({wrap:"circular"}),n.find(".jcarousel-control-prev").jcarouselControl({target:"-=1"}),n.find(".jcarousel-control-next").jcarouselControl({target:"+=1"})},bindData:function(n){var e=this;this.playedListParams.anchor=n,this.playedListModel.executeJSONP(this.playedListParams,function(n){if(n&&"SUCCESS"===n.msg&&n.data.totalCount>0){var t=_.template(e.anchorPlayedTpl);e.playedList.html(t(n.data)),e.initCarousel()}else e.hideListWrap()},function(n){e.hideListWrap()})},hideListWrap:function(){this.$el.hide()}});n.exports=s},126:function(n,e,t){"use strict";var o=t(19),i=null,r=o.extend({url:"{{url_prefix}}/room/anchor_end_list.json",beforeEmit:function(n){}});r.sigleInstance=function(){return i||(i=new r),i},n.exports=r},129:function(n,e){},130:function(n,e,t){"use strict";var o=t(11),i=t(21),r=t(36),a=t(22),s=a.sharedInstanceUserModel(),c=t(34),u=t(35),f=t(46),l=t(18),d=l.sharedInstanceIMModel(),m=t(17),p=t(115),h=t(116),g=o.extend({clientRender:!1,el:"#anchorContainerBg",events:{},beforeMount:function(){var n=i.parse(location.href);n.query.roomId||window.history.go(-1),this.roomId=n.query.roomId||1,this.roomInfoPeriod=1e4,this.roomDetail=c.sigleInstance(),this.anchorInfoModel=p.sigleInstance(),this.roomDetailParams={deviceinfo:'{"aid": "30001001"}',access_token:"web-"+s.getToken(),roomId:""},this.roomLongPolling=u.sigleInstance(),this.anchorInfoParams={deviceinfo:'{"aid": "30001001"}',access_token:"web-"+s.getToken()}},afterMount:function(){},ready:function(){this.defineEventInterface(),this.getUserInfo(),this.renderPage()},defineEventInterface:function(){},fetchUserIMSig:function(n){var e=this;d.fetchIMUserSig(function(t){e.userIMSig=t,e.initWebIM();var o=function(){window.history.go(-1)};m.applyJoinGroup(n,function(n){Backbone.trigger("event:roomInfoReady",e.roomInfo),2==e.roomInfo.status&&e.loopRoomInfo()},function(n){10013==n.ErrorCode?(Backbone.trigger("event:roomInfoReady",e.roomInfo),2==e.roomInfo.status&&e.loopRoomInfo()):r.show({title:"进入房间",content:"进入房间失败,请稍后重试",cancelFn:o,okFn:o})})})},renderPage:function(){var n=t(117);new n;var e=t(123);new e;var o=t(125);new o},initWebIM:function(){function n(n){Backbone.trigger("event:groupSystemNotifys",n)}m.init({onConnNotify:function(n){Backbone.trigger("event:onConnNotify",n)},onMsgNotify:function(n){Backbone.trigger("event:onMsgNotify",n)},onGroupInfoChangeNotify:function(n){Backbone.trigger("event:onGroupInfoChangeNotify",n)},groupSystemNotifys:{1:n,2:n,3:n,4:n,5:n,6:n,7:n,8:n,9:n,10:n,11:n,255:n}})},initRoom:function(){var n=this,e=function(){r.show({title:"提示",content:"获取房间数据失败!",okFn:function(){n.goBack()},cancelFn:function(){n.goBack()}})};this.getRoomInfo(function(t){var o=t.data||{};t&&"0"==t.code?(n.videoUrl={streamName:o.streamName,url:o.url},n.roomInfo=o,Backbone.trigger("event:roomInfoReady",n.roomInfo)):e()},e)},getGroupInfo:function(n){var e=this;m.getGroupInfo(n,function(n){n&&0==n.ErrorCode&&(e.currentGroupInfo=_.find(n.GroupInfo,function(n){return n.GroupId==e.roomInfo.imGroupid}),Backbone.trigger("event:IMGroupInfoReady",e.currentGroupInfo),e.checkUserIsKickout(e.currentGroupInfo.Notification))},function(n){})},getUserInfo:function(){var n=this;h.getInfo(function(e){n.userInfo=e,Backbone.trigger("event:currentUserInfoReady",e),n.initRoom()})},getRoomInfo:function(n,e){var t=this;t.roomDetailParams.roomId=t.roomId,this.roomDetail.executeJSONP(t.roomDetailParams,function(e){n&&n(e)},function(n){e&&e(n)})},checkRoomStatus:function(n){switch(n){case 0:f.showTip("该直播尚未发布!");break;case 1:break;case 2:this.getGroupInfo(this.roomInfo.imGroupid);break;case 3:}},checkUserIsKickout:function(n){var e=this,t=null;try{t=_.isString(n)?JSON.parse(n):n}catch(o){}if(t){var i=_.find(t.forbidUsers,function(n){return n.replace("$0","")==e.userIMSig.userId});i&&(h.setKickout(e.roomId,!0),r.show({title:"禁止进入",content:"您已经被主播踢出房间!",okFn:function(){e.goBack()},cancelFn:function(){e.goBack()}}))}},goBack:function(){},loopRoomInfo:function(){var n=this;n.roomInfoTimeId=setTimeout(function(){n.roomDetailParams.roomId=n.roomId,n.getRoomLoopInfo(function(e){var t=e.data;Backbone.trigger("event:updateRoomInfo",t),n.loopRoomInfo()})},n.roomInfoPeriod)},getRoomLoopInfo:function(n,e){var t=this;t.roomDetailParams.roomId=t.roomId,this.roomLongPolling.executeJSONP(t.roomDetailParams,function(e){n&&n(e)},function(n){e&&e(n)})}});n.exports=g}});