/**
 * @project yinyuetai_pc_live_video
 * @description 音悦台直播PC版
 * @version v1.0.0
 * @time 2016-3-16   21:19:1
 * @author YYT
 * @copy http://www.yinyuetai.com
 */
webpackJsonp([0],[function(e,n,t){$(function(){var e=t(9);new e;var n=t(61);new n,t(65)})},,,,,,,,,function(e,n,t){"use strict";var o=t(10),i=t(16),r=t(21),s=r.sharedInstanceUserModel(),a=t(33),c=t(20),d=(t(34),t(35)),f=o.extend({clientRender:!1,el:"#anchorContainerBg",events:{},beforeMount:function(){var e=c.parse(location.href);this.roomId=e.query.roomId||1,this.roomId||this.goBack(),this.roomDetail=new a},afterMount:function(){},ready:function(){this.userVerify()},initWebIM:function(){function e(e){$(document).trigger("event:groupSystemNotifys",e)}i.init({onConnNotify:function(e){$(document).trigger("event:onConnNotify",e)},onMsgNotify:function(e){$(document).trigger("event:onMsgNotify",e)},onGroupInfoChangeNotify:function(e){$(document).trigger("event:onGroupInfoChangeNotify",e)},groupSystemNotifys:{1:e,2:e,3:e,4:e,5:e,6:e,7:e,8:e,9:e,10:e,11:e,255:e}})},userVerify:function(){var e=this;s.getUserInfo(function(e){}),s.isLogined()?(e.initWebIM(),e.roomDetail.setChangeURL({deviceinfo:'{"aid": "30001001"}',accessToken:s.getToken(),roomId:this.roomId}),e.initRoom(),e.renderPage()):e.goBack()},initRoom:function(){var e=this;this.roomDetail.executeGET(function(e){$(document).trigger("event:roomInfoReady",e.data)},function(n){d.show({title:"提示",content:"获取房间数据失败!",okFn:function(){e.goBack()},cancelFn:function(){e.goBack()}})})},renderPage:function(){var e=t(37);new e;var n=t(44);new n;var o=t(48);new o;var i=t(53);new i;var r=t(57);new r},goBack:function(){window.location.href="/web/anchor-setting.html"}});e.exports=f},,,,,,,function(e,n,t){"use strict";var o=(t(17),t(19)),i={setting:{listeners:{onMsgNotify:null,onGroupInfoChangeNotify:null,groupSystemNotifys:null}}};i.init=function(e){var n=o.get("imSig"),t={sdkAppID:n.imAppid,appIDAt3rd:n.imAppid,accountType:n.imAccountType,identifier:n.imIdentifier,userSig:n.userSig};n&&e&&webim.init(t,e,null)},i.clearScreen=function(){},i.lockScreen=function(){},i.disableSendMsg=function(e,n,t){var o=webim.Tool.formatTimeStamp(Math.round((new Date).getTime()/1e3)+600);o=new Date(o+"").getTime(),e=_.extend({ShutUpTime:o},e),webim.forbidSendMsg(e,function(e){n&&n(e)},function(e){t&&t(e)})},i.removeUserFromGroup=function(e,n,t){(!e||!e.GroupId||e.MemberToDel_Account.length<=0)&&t&&t({msg:"参数不正确"}),webim.deleteGroupMember(e,function(e){n&&n(e)},function(e){t&&t(e)})},i.msgNotify=function(e){},i.getRoomMsgs=function(e){for(var n=[],t=1;;){if(t++>20)break;n.push({name:"Aaron-"+t,msg:"asdfasdfasfjaslfjasklfasdklf"+t})}e&&e.call(this,n)},i.createIMChatRoom=function(e,n){var t=o.get("imSig"),i={Owner_Account:t.imIdentifier,Type:"ChatRoom",Name:"测试聊天室",Notification:"",Introduction:"",MemberList:[]};webim.createGroup(i,function(n){e&&e(n)},function(e){n&&n(e)})},i.getGroupInfo=function(e,n,t){var o={GroupIdList:[e],GroupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption"],MemberInfoFilter:["Account","Role","JoinTime","LastSendMsgTime","ShutUpUntil"]};webim.getGroupInfo(o,function(e){n&&n(e)},function(e){alert(e.ErrorInfo),t&&t(e)})},i.modifyGroupInfo=function(e,n,t){webim.modifyGroupBaseInfo(e,function(e){n&&n(e)},function(e){t&&t(e)})},e.exports=i},,,,,,,,,,,,,,,,,function(e,n,t){"use strict";var o=t(18),i=o.extend({url:"{{url_prefix}}/room/detail.json?deviceinfo={{deviceinfo}}&access_token=web-{{accessToken}}&roomId={{roomId}}",beforeEmit:function(e){}});e.exports=i},,,,function(e,n,t){var o=t(10),i=t(38),r=t(39),s=t(34),a=o.extend({el:"#edit_background",rawLoader:function(){return t(43)},events:{"click .edit_bg_btn":"showFileUploadDialog"},beforeMount:function(){this.editBgModel=new i,this.uploadFile=new r(this.getFileUploadOptions())},afterMount:function(){this.changeBgBtn=$(".edit_bg_btn"),this.txtPopularity=$("#txtPopularity"),this.txtRoomName=$("#txtRoomName")},ready:function(){this.defineEventInterface(),this.editBgModel.execute(function(e){this.$get("items")},function(e){}),this.on("event-name",function(e){})},defineEventInterface:function(){var e=this;$(document).on("event:roomInfoReady",function(n,t){t&&(e.roomInfo=t,e.txtRoomName.text(t.roomName||""),e.txtPopularity.text(t.popularity||0))})},getFileUploadOptions:function(){var e=this;return{width:580,height:341,isRemoveAfterHide:!1,isAutoShow:!1,mainClass:"shadow_screen_x",closeClass:"editor_bg_close_x",closeText:"X",ctrlData:{cmd:[{saveOriginal:1,op:"save",plan:"avatar",belongId:"20634338",srcImg:"img"}],redirect:window.location.origin+"/web/upload.html"},uploadFileSuccess:function(n){e.fileUploadResultHandler(!0,n)},saveFile:function(){e.fileUploadResultHandler(!1)}}},showFileUploadDialog:function(){this.uploadFile.show()},fileUploadResultHandler:function(e,n){return e?void s.showOK("背景图片设置成功"):(s.showError("背景图片设置失败"),null)}});e.exports=a},function(e,n,t){var o=t(18),i=o.extend({url:"{{url_prefix}}/",beforeEmit:function(e){}});e.exports=i},,,,,function(e,n){e.exports='<div class="title fl" id="txtRoomName">20160408金在中出道纪念会</div>\r\n<div class="popularity fl">人气:<span id="txtPopularity">0</span></div>\r\n<div class="edit_bg_btn fr">更换主题背景</div>\r\n<!--上传图片弹出层-->\r\n<div style="display: none;" class="shadow_screen">\r\n  <div class="shadow"></div>\r\n  <div class="edit_Bg_form">\r\n    <h2 class="edit_title">背景图设置<span class="upload-status">正在上传</span><span  class="upload-status">上传完成!</span><span class="close">X</span></h2>\r\n    <div class="formCon clearfix">\r\n      <div class="imgBox fl">\r\n        <img src="" alt="" style="display: none;">\r\n      </div>\r\n      <div class="formBox fl">\r\n        <form action="">\r\n          <div class="pseudo-uploadBtn">\r\n            上传图片\r\n            <input type="file" name="" id="file">\r\n          </div>\r\n          <p>支持5M以内的gif、jpg、jpge、png图片上传</p>\r\n          <div class="submit">保存</div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'},function(e,n,t){var o=t(10),i=(t(45),o.extend({el:"#currentAnchorInfo",rawLoader:function(){return t(46)},events:{},beforeMount:function(){this.infoTpl=t(47)},afterMount:function(){this.roomInfoWrap=$("#roomInfoWrap")},ready:function(){this.defineEventInterface()},defineEventInterface:function(){var e=this;$(document).on("event:roomInfoReady",function(n,t){var o=_.template(e.infoTpl),i=o(t);e.roomInfoWrap.append(i)})}}));e.exports=i},function(e,n,t){var o=t(18),i=o.extend({url:"{{url_prefix}}/",beforeEmit:function(e){}});e.exports=i},function(e,n){e.exports='<!--<span class="anchor_avator fl"></span>-->\r\n<img id="imgRoomPic" src="" alt="" class="anchor_avator fl">\r\n<dl class="anchorMsg fl" id="roomInfoWrap">\r\n</dl>\r\n'},function(e,n){e.exports="<dt><%=roomName%></dt>\r\n<dd>在线人数:<span><%=online%></span></dd>\r\n<dd>标签:<i>金在中</i><i>金在</i></dd>"},function(module,exports,__webpack_require__){var BaseView=__webpack_require__(10),YYTIMServer=__webpack_require__(16),RoomMessageModel=__webpack_require__(49),uiConfirm=__webpack_require__(35),UserModel=__webpack_require__(21),user=UserModel.sharedInstanceUserModel(),DateTime=__webpack_require__(50),msgBox=__webpack_require__(34),View=BaseView.extend({el:"#anchorCtrlChat",rawLoader:function(){return __webpack_require__(51)},events:{"click #btn-clear":"clearHandler","click #btn-lock":"lockClickHandler","click #msgList":"messageClickHandler"},beforeMount:function(){this.roomMsgModel=new RoomMessageModel,this.forbidUsers=[]},afterMount:function(){this.themeBgEle=$("#anchorContainerBg"),this.msgList=$("#msgList"),this.chatHistory=$("#chatHistory"),this.btnLock=$("#btn-lock"),this.defineEventInterface()},ready:function(){},clearHandler:function(){var e=this,n=e.checkLiveRoomReady();n&&uiConfirm.show({content:"您确定要清屏吗?",okFn:function(){e.clearMessageList(),YYTIMServer.clearScreen()}})},lockClickHandler:function(){var e=this.checkLiveRoomReady();if(e){var n=this.btnLock.children("span"),t=this,o="锁屏"==n.text()?"锁定屏幕":"解开屏幕";uiConfirm.show({content:"您确定要"+o+"吗?",okFn:function(){t.lockIMHandler("锁屏"==n.text())}})}},lockIMHandler:function(e){var n=this,t={GroupId:this.roomInfo.imGroupid};e===!0?t.Introduction=JSON.stringify({blockState:!!e,alert:"播主设定锁定屏幕，不能发送弹幕及礼物"}):t.Introduction=JSON.stringify({blockState:!1});var o=e===!0?"锁屏":"解屏";YYTIMServer.modifyGroupInfo(t,function(t){t&&"OK"==t.ActionStatus?(n.btnLock.children("span").text(e===!0?"解屏":"锁屏"),msgBox.showOK(o+"成功!")):msgBox.showError(o+"操作失败,请稍后重试")},function(e){msgBox.showError(o+"操作失败,请稍后重试")})},clearMessageList:function(){this.msgList.children().remove()},messageClickHandler:function(e){var n,t;n=$(e.target).parent(),n.hasClass("controls_forbid_reject")?this.msgControlHandler(e):(t=$(e.target).parents("li"),this.showMsgControlMenu(t))},showMsgControlMenu:function(e){if(!(e.length<=0)){var n=e.find(".controls_forbid_reject"),t=$("#msgList").find("li").index(e);$(".controls_forbid_reject").not(n).hide(),0===t&&n.css("margin-top","33px"),n.toggle()}},msgControlHandler:function(e){var n,t=$(e.target);n=t.parents("li"),"禁言"===t.text()?this.disableSendMsgConfirm({name:n.attr("data-name"),id:n.attr("data-id")}):"踢出"===t.text()&&this.removeUserFromRoom({name:n.attr("data-name"),id:n.attr("data-id")})},disableSendMsgConfirm:function(e){var n=this;uiConfirm.show({content:"您确定要禁止用户:<b>"+e.name+"</b>发言吗?",okFn:function(){n.disableSendMsgHandler(e)}})},disableSendMsgHandler:function(e){var n=this,t=[];t.push(e.id),YYTIMServer.disableSendMsg({GroupId:n.roomInfo.imGroupid,Members_Account:t},function(n){n&&"OK"===n.ActionStatus?msgBox.showOK("已将用户:<b>"+e.name+" 禁言10分钟."):msgBox.showError("禁言失败,请稍后重试!")},function(){msgBox.showError("禁言失败,请稍后重试!")})},removeUserFromRoom:function(e){function n(){t.forbidUsers.length>200&&t.forbidUsers.shift(),t.forbidUsers.push(e.id);var n={GroupId:t.roomInfo.imGroupid,Notification:JSON.stringify({forbidUsers:t.forbidUsers})};YYTIMServer.modifyGroupInfo(n,function(n){n&&"OK"===n.ActionStatus?msgBox.showOK("成功将用户:<b>"+e.name+"</b>踢出房间"):msgBox.showError("将用户:<b>"+e.name+"</b>踢出房间失败,请稍后再试")})}var t=this;uiConfirm.show({content:"您确定要将用户:<b>"+e.name+"</b>踢出房间吗?",okFn:function(){n()}})},renderGroupMsgs:function(e){},onMsgNotify:function(e){this.addMessage(e)},onGroupInfoChangeNotify:function(e){},groupSystemNotifys:function(e){},getMessageTpl:function(){return __webpack_require__(52)},addMessage:function(data){var self=this,msgObj={};if(data.elems&&data.elems.length>0){if(msgObj=data.elems[0].content.text+"",msgObj=msgObj.replace(/&quot;/g,"'"),eval("msgObj = "+msgObj),msgObj=_.extend({nickName:"匿名",content:"",smallAvatar:"",time:self.getDateStr(new Date)},msgObj),msgObj&&msgObj.roomId!==self.roomInfo.id)return;if(msgObj&&msgObj.content){msgObj.fromAccount=data.fromAccount;var tpl=_.template(this.getMessageTpl());this.msgList.append(tpl(msgObj)),this.chatHistory.scrollTop(this.msgList.height())}}},defineEventInterface:function(){var e=this;$(document).on("event:LiveShowStarted",function(e,n){}),$(document).on("event:liveShowEnded",function(e,n){}),$(document).on("event:roomInfoReady",function(n,t){t&&(e.roomInfo=t,e.roomInfoReady())}),$(document).on("event:onConnNotify",function(e,n){}),$(document).on("event:onMsgNotify",function(n,t){e.onMsgNotify(t)}),$(document).on("event:onGroupInfoChangeNotify",function(n,t){e.onGroupInfoChangeNotify(t)}),$(document).on("event:groupSystemNotifys",function(n,t){e.groupSystemNotifys(t)})},roomInfoReady:function(){var e=this;e.getMessageFromServer(),e.getGroupInfo()},getMessageFromServer:function(){var e=this;e.roomMsgModel.setChangeURL({deviceinfo:'{"aid": "30001001"}',accessToken:user.getToken(),limit:100,endTime:0,startTime:0,cursor:"",roomId:e.roomInfo.id}),e.roomMsgModel.executeGET(function(e){},function(e){})},getGroupInfo:function(){var e=this;YYTIMServer.getGroupInfo(e.roomInfo.imGroupid,function(n){if(n&&"OK"===n.ActionStatus&&n.GroupInfo&&n.GroupInfo[0]&&n.GroupInfo[0].Introduction){var t=JSON.parse(n.GroupInfo[0].Introduction);t&&t.blockState===!0&&e.btnLock.children("span").text("解屏")}},function(e){msgBox.showError(e.msg||"获取群组消息失败!")})},getDateStr:function(e){var n=new Date(e);return n.Format("hh:MM:ss")},checkLiveRoomReady:function(){switch(this.roomInfo.status){case 0:return msgBox.showTip("该直播尚未发布!"),!1;case 1:case 2:return this.roomInfo&&this.roomInfo.imGroupid?!0:(msgBox.showTip("请先开始直播!"),!1);case 3:return msgBox.showTip("该直播已经结束!"),!1}}});module.exports=View},function(e,n,t){"use strict";var o=t(18),i=o.extend({url:"{{url_prefix}}/message/get.json?deviceinfo={{deviceinfo}}&access_token=web-{{accessToken}}&roomId={{roomId}}&startTime={{startTime}}&endTime={{endTime}}&cursor={{cursor}}&limit={{limit}}",beforeEmit:function(e){}});e.exports=i},,function(e,n){e.exports='<div class="controls clearfix">\r\n    <div id="btn-clear" class="fl"><img src="../img/clear.png" alt="">清屏</div>\r\n    <div id="btn-lock" class="fl"><img src="../img/clock.png" alt="" class="lock"><span>锁屏</span></div>\r\n</div>\r\n<div class="chatCon" id="chatHistory">\r\n    <!--聊天记录-->\r\n    <ul id="msgList">\r\n    </ul>\r\n</div>\r\n'},function(e,n){e.exports='<li class="clearfix" data-name="<%=nickName%>" data-id="<%=fromAccount%>">\r\n  <img onerror="this.src=\'../img/visitor_avator.jpg\'" src="<%=smallAvatar%>" alt="" class="fl visitor_avator">\r\n  <p class="visitor_chat fl">\r\n    <span class="visitorName"><%=nickName%>:</span>\r\n    <%=content%>\r\n    <span class="time fr"><%=time%></span>\r\n  </p>\r\n  <div class="controls_forbid_reject">\r\n    <a href="javascript:;" class="forbid">禁言</a>\r\n    <a href="javascript:;" class="reject">踢出</a>\r\n  </div>\r\n</li>\r\n'},function(e,n,t){"use strict";var o=t(10),i=t(54),r=t(55),s=t(21),a=t(34),c=s.sharedInstanceUserModel(),d=o.extend({el:"#noticeWraper",rawLoader:function(){return t(56)},events:{"click #btnEditNotice":"editClickHandler","click .closeNoticePanel":"panelDisplay","click #btnSubmitNotice":"submitClickHandler"},beforeMount:function(){this.noticeModel=new i,this.noticeGetModel=new r},afterMount:function(){this.editNoticPanel=$("#editNoticPanel"),this.noticeWrap=$("#noticeWrap"),this.txtNotice=$("#txtNotice"),this.imgRoomPic=$("#imgRoomPic"),this.errNoticeTip=$("#errNoticTip")},ready:function(){this.defineEventInterface()},editClickHandler:function(e){this.panelDisplay(!0)},panelDisplay:function(e){this.errNoticeTip.text(""),e===!0?(this.txtNotice.val(this.noticeInfo.content),this.editNoticPanel.show()):this.editNoticPanel.hide()},submitClickHandler:function(e){var n=this.txtNotice.val().trim(),t=this;return!n||n.length>50||n.length<=0?(this.errNoticeTip.text("公告文字请在50字以内"),null):void this.noticeModel.executePOST({roomId:this.roomInfo.id,content:n},function(e){e&&"0"==e.code?($(document).trigger("event:noticeChanged",n),t.roomInfo.desc=n,t.noticeWrap.text(n),t.panelDisplay()):a.showError("数据保存失败,请稍后重试")},function(e){a.showError("数据保存失败,请稍后重试")})},defineEventInterface:function(){var e=this;$(document).on("event:roomInfoReady",function(n,t){t&&(e.roomInfo=t),e.getNoticeInfo(),t.imageUrl&&e.imgRoomPic.attr("src",t.imageUrl)})},getNoticeInfo:function(){var e=this;this.noticeGetModel.setChangeURL({deviceinfo:'{"aid":"30001001"}',roomId:this.roomInfo.id,accessToken:c.getToken()}),this.noticeGetModel.executeGET(function(n){if(n&&n.data){var t=null;n.data.placards&&(t=n.data.placards[0]),t?(e.noticeInfo=t,e.noticeWrap.text(t.content||"暂无公告"),e.txtNotice.val(t.content)):e.noticeWrap.text("暂无公告")}},function(e){a.showErr(e.msg||"获取公告失败")})}});e.exports=d},function(e,n,t){"use strict";var o=t(18),i=o.extend({url:"{{url_prefix}}/room/placard_create.json",beforeEmit:function(e){}});e.exports=i},function(e,n,t){"use strict";var o=t(18),i=o.extend({url:"{{url_prefix}}/room/placard_get.json?deviceinfo={{deviceinfo}}&access_token=web-{{accessToken}}&roomId={{roomId}}",beforeEmit:function(e){}});e.exports=i},function(e,n){e.exports='<h2 class="clearfix annoucement">\r\n    <span class="fl .annoucement_title">公告</span>\r\n    <span id="btnEditNotice" class="fr annoucement_editr">编辑</span>\r\n</h2>\r\n<p id="noticeWrap"></p>\r\n<!--编辑公告弹出框-->\r\n<div id="editNoticPanel" style="display: none;" class="shadow_screen">\r\n    <div class="shadow closeNoticePanel"></div>\r\n    <div class="edit_annmoucement_con">\r\n        <h2 class="edit_title">文字输入<span class="close closeNoticePanel">X</span></h2>\r\n        <div class="editCon">\r\n            <h3>公告内容:</h3>\r\n            <textarea id="txtNotice" placeholder="(公告文字请在50字以内)" maxlength="50"></textarea>\r\n            <div id="errNoticTip" class="errTip"></div>\r\n            <p style="padding-top: 16px;">\r\n                <a href="####" class="cancel closeNoticePanel">取消</a>\r\n                <a id="btnSubmitNotice" href="####" class="submit">确定</a>\r\n            </p>\r\n        </div>\r\n    </div>\r\n</div>\r\n'},function(e,n,t){"use strict";var o=t(10),i=t(16),r=t(35),s=t(34),a=t(58),c=t(59),d=t(21),f=d.sharedInstanceUserModel(),u=o.extend({el:"#liveShowBtnWraper",rawLoader:function(){return t(60)},events:{"click .endLive":"endLiveClick","click .startLive":"startLiveClick"},beforeMount:function(){this.startLiveModel=new a,this.endLiveModel=new c},afterMount:function(){this.btnEndLive=$(".endLive"),this.btnStartLive=$(".startLive"),this.defineEventInterface()},ready:function(){},startLiveClick:function(e){var n=$(e.target),t=this;return n.hasClass("m_disabled")?null:(n.addClass("m_disabled"),this.btnEndLive.removeClass("m_disabled"),this.roomInfo?void(this.roomInfo.imGroupid?t.startLive():i.createIMChatRoom(function(e){t.roomInfo.imGroupid=e.GroupId,t.startLive()},function(e){})):(s.showError("没有获取到房间信息"),""))},startLive:function(){var e=this;e.startLiveModel.setChangeURL({deviceinfo:JSON.stringify({aid:"30001001"}),accessToken:f.getToken(),roomId:e.roomInfo.id,imGroupId:encodeURIComponent(e.roomInfo.imGroupid)}),e.startLiveModel.executeGET(function(e){s.showOK("成功开启直播"),$(document).trigger("event:LiveShowStarted")},function(e){s.showError(e.msg)})},endLiveClick:function(e){var n=this;return this.btnEndLive.hasClass("m_disabled")?null:void r.show({title:"消息",content:"您确定要结束直播吗",okFn:function(){n.endLive()},cancelFn:function(){}})},endLive:function(){var e=this;e.endLiveModel.setChangeURL({deviceinfo:'{"aid": "30001001"}',accessToken:f.getToken(),roomId:e.roomInfo.id}),e.endLiveModel.executeGET(function(n){e.btnEndLive.addClass("m_disabled"),e.isLiveShowing=!1,$(document).trigger("event:liveShowEnded"),e.btnStartLive.removeClass("m_disabled")},function(e){s.showError(e.msg)})},defineEventInterface:function(){var e=this;$(document).on("event:roomInfoReady",function(n,t){t&&(e.roomInfo=t,e.changeButtonStatus(e.roomInfo.status))})},changeButtonStatus:function(e){2===e&&(this.btnStartLive.addClass("m_disabled"),this.btnEndLive.removeClass("m_disabled"))}});e.exports=u},function(e,n,t){"use strict";var o=t(18),i=o.extend({url:"{{url_prefix}}/room/start.json?deviceinfo={{deviceinfo}}&access_token=web-{{accessToken}}&roomId={{roomId}}&imGroupId={{imGroupId}}",beforeEmit:function(e){}});e.exports=i},function(e,n,t){"use strict";var o=t(18),i=o.extend({url:'{{url_prefix}}/room/close.json?deviceinfo={"aid":"30001001"}&access_token=web-{{accessToken}}&roomId={{roomId}}',beforeEmit:function(e){}});e.exports=i},function(e,n){e.exports='<div class="endLive m_disabled">结束本次直播</div>\r\n<div class="startLive">开启直播</div>\r\n'},,,,,function(e,n){}]);