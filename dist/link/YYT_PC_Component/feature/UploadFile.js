"use strict";!function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"object"==typeof exports&&"object"==typeof module?module.exports=t():"object"==typeof exports?exports.UploadFile=t():(e.ICEPlugs||(e.ICEPlugs={}),e.ICEPlugs.UploadFile=t())}(function(){var t=999,e=window,o=e.ICEPlugs||{},i=o.url;i||(i=require("url"));var s=o.tools;s||(s=require("tools"));var r=o.AjaxForm;r||(r=require("AjaxForm"));var a=null,l=function(e){var o=this;return this.$el="string"==typeof e.el?$(e.el):e.el,this.uid="UploadFile"+t++,this.options=e,this._data=e.data||{},this._filename=e.filename||"image",this._success=e.success,this._before=e.before,this._failure=e.failure,this._url=e.url,this._url?(this._init(),void(this.ajaxForm=r.classInstanceAjaxForm(this.$el,{type:"img",success:function(){var t=this.contentWindow,e=(t.location,decodeURIComponent(t.location.search)),s=i.parseSearch(e);"function"==typeof o._success&&o._success.call(this,s)},failure:function(){"function"==typeof o._failure&&o._failure.call(this)}}))):void console.warn("配置上传URL")};return l.prototype._init=function(){this._createElement()},l.prototype._createElement=function(){var t="";for(var e in this._data){var o=this._data[e],i=s.toType(o);"[object Object]"!==i&&"[object Array]"!==i||(o=JSON.stringify(o)),t+='<input type="hidden" name="'+e+"\" value='"+o+"'/>"}t+='<input type="file" class="opacity0 upload-file '+this.options.className+'" name="'+this._filename+'"  />',this.$el.attr("method","POST"),this.$el.attr("action",this._url),this.$el.attr("enctype","multipart/form-data"),this.$el.append(t)},l.prototype.submit=function(){this.ajaxForm.setIframeState(!0),"function"==typeof this._before&&this._before(),this.$el.submit()},l.sharedInstanceUploadFile=function(t){return a||(a=new l(t)),a},l.classInstanceUploadFile=function(t){return new l(t)},l.prototype.parseErrorMsg=function(t){if(t&&"SUCCESS"==t.state)return!0;var e=1*t.errCode||0;switch(e){case 29:return"上传的文件太大了,请重新上传";case 31:return"请上传JPGE,JPG,PNG,GIF等格式的图片文件"}return"文件上传失败,请重新上传"},l});