"use strict";var BaseView=require("BaseView"),Mask=require("./mask.js"),mask,uid=999,body=document.body,View=BaseView.extend({clientRender:!1,events:{"click .J_close":"_close"},beforeMount:function(){this.id="YYT_UI_Dialog"+uid++,this.options={width:"",height:"",hasMark:!0,hasClose:!0,isRemoveAfterHide:!0,isAutoShow:!0,title:"",className:"",effect:"fade",draggable:!1,mainClass:"dialog",closeClass:"ico_close J_close",closeText:"关闭",onShow:function(){},onHide:function(){}},this.options=_.extend(this.options,this._ICEOptions),this._status=!1,this.$el=$('<div id="'+this.id+'" class="'+this.options.mainClass+'"/>').append(this.$el.show()).addClass(this.options.className).appendTo(document.body),this.$title=this.$el.find(".upload-title"),this._ICEinitEvent()},afterMount:function(){this.closeTemp=require("./template/close.html"),this.titleTemp=require("./template/title.html")},ready:function(){this._renderTitle(),this._renderClose(),this._adjustPosition(),this.on("show",function(){this._status=!0,this._toggle("show")}),this.on("hide",function(){this._status=!1,this._toggle("hide")}),this.on("show",this.options.onShow,this.$el),this.on("hide",this.options.onHide,this.$el),this.options.isAutoShow&&this.trigger("show"),"function"==typeof this.options.attached&&this.options.attached.call(this)},_renderTitle:function(){var t=this.options.title;t&&this.$title.text(t)},_renderClose:function(){if(this.options.hasClose){var t=this,i="dialogClose"+uid++,s=this.compileHTML(this.closeTemp,{closeClass:this.options.closeClass,closeText:this.options.closeText,id:i});$(s).attr("hidefocus","true").appendTo(this.$el),$("#"+i).on("click",function(i){i.preventDefault(),t.hide()})}},_adjustPosition:function(){var t={width:this.options.width||this.$el.innerWidth(),height:this.options.height?this.options.height:this.$el.innerHeight()};this.$el.css(_.extend({marginLeft:-(t.width/2),marginTop:-(t.height/2)},t))},_close:function(){this.trigger("hide")},_toggle:function(t){var i=this.options.effect,s=this;"show"==t?"none"===i?this.$el.css("display","block"):"fade"===i&&this.$el.fadeIn():"hide"==t&&("none"===i?this.$el.css("display","none"):"fade"===i&&this.$el.fadeOut(),this.options.isRemoveAfterHide&&setTimeout(function(){s.$el.remove()},2e3)),this._toggleMask(t)},_toggleMask:function(t){this.options.hasMark&&("show"==t?mask.show():"hide"==t&&mask.hide())},status:function(){return this._status?"show":"hide"},show:function(){return this.trigger("show"),this},hide:function(){return this.trigger("hide"),this},destroy:function(){this.$el.remove(),mask.hide()},resize:function(t,i){return this.options.width=t,this.options.height=i,this._adjustPosition(),this},title:function(t){return this.$title&&this.$title.html(t),this}}),shared=null;View.sharedInstanceDialog=function(t){return shared||(mask||(mask=Mask.classInstanceMask()),shared=new View(t||{})),shared},View.classInstanceDialog=function(t,i){return i=i||{},i.el=t||"<b></b>",mask||(mask=Mask.classInstanceMask()),new View(i)},module.exports=View;