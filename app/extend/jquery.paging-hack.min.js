(function(b,a,c){b["fn"]["paging"]=function(g,f){var e=this,d={"isFinished":false,"setOptions":function(i){var h=function(o){var j=0,p=0,k=1,n={fstack:[],asterisk:0,inactive:0,blockwide:5,current:3,rights:0,lefts:0},r,m=/[*<>pq\[\]().-]|[nc]+!?/g;var q={"[":"first","]":"last","<":"prev",">":"next","q":"left","p":"right","-":"fill",".":"leap"},l={};while((r=m["exec"](o))){r=""+(r);if(c===q[r]){if("("===r){p=++j}else{if(")"===r){p=0}else{if(k){if("*"===r){n.asterisk=1;n.inactive=0}else{n.asterisk=0;n.inactive="!"===r.charAt(r.length-1);n.blockwide=r["length"]-n.inactive;if(!(n.current=1+r.indexOf("c"))){n.current=(1+n.blockwide)>>1}}n.fstack[n.fstack.length]=({ftype:"block",fgroup:0,fpos:0});k=0}}}}else{n.fstack[n.fstack.length]=({ftype:q[r],fgroup:p,fpos:c===l[r]?l[r]=1:++l[r]});if("q"===r){++n.lefts}else{if("p"===r){++n.rights}}}}return n};d.opts=b.extend(d.opts||{"lapping":0,"perpage":10,"page":1,"refresh":{"interval":10,"url":null},"format":"","lock":false,"onFormat":function(j){},"onSelect":function(j){return true},"onRefresh":function(j){}},i||{});d.opts["lapping"]|=0;d.opts["perpage"]|=0;if(d.opts["page"]!==null){d.opts["page"]|=0}if(d.opts["perpage"]<1){d.opts["perpage"]=10}if(d.interval){a.clearInterval(d.interval)}if(d.opts["refresh"]["url"]){d.interval=a.setInterval(function(){b["ajax"]({"url":d.opts["refresh"]["url"],"success":function(j){if(typeof(j)==="string"){try{j=b["parseJSON"](j)}catch(k){return}}d.opts["onRefresh"](j)}})},1000*d.opts["refresh"]["interval"])}d.format=h(d.opts["format"]);return d},"setNumber":function(h){d.number=(c===h||h<0)?-1:h;return d},"setPage":function(v){if(d.opts["lock"]){d.opts["onSelect"](0);return d}if(c===v){v=d.opts["page"];if(null===v){return d}}else{if(d.opts["page"]==v){return d}}d.opts["page"]=(v|=0);var p=d.number;var h=d.opts;var x,k;var l,q;var m=1,w=d.format;var t,s,n,o;var u=w.fstack["length"],r=u;if(h["perpage"]<=h["lapping"]){h["lapping"]=h["perpage"]-1}o=p<=h["lapping"]?0:h["lapping"]|0;if(p<0){p=-1;l=-1;x=Math.max(1,v-w.current+1-o);k=x+w.blockwide}else{l=1+Math.ceil((p-h["perpage"])/(h["perpage"]-o));v=Math.max(1,Math.min(v<0?1+l+v:v,l));if(w.asterisk){x=1;k=1+l;w.current=v;w.blockwide=l}else{x=Math.max(1,Math.min(v-w.current,l-w.blockwide)+1);k=w.inactive?x+w.blockwide:Math.min(x+w.blockwide,1+l)}}while(r--){s=0;n=w.fstack[r];switch(n.ftype){case"left":s=(n.fpos<x);break;case"right":s=(k<=l-w.rights+n.fpos);break;case"first":s=(w.current<v);break;case"last":s=(w.blockwide<w.current+l-v);break;case"prev":s=(1<v);break;case"next":s=(v<l);break}m|=s<<n.fgroup}t={"number":p,"lapping":o,"pages":l,"perpage":h["perpage"],"page":v,"slice":[(s=v*(h["perpage"]-o)+o)-h["perpage"],Math.min(s,p)]};q="";function j(y,z,i){i=""+(y["onFormat"].call(z,i));if(z["value"]){q+=i.replace(/<a/i,'<a data-page="'+z["value"]+'"')}else{q+=i}}while(++r<u){n=w.fstack[r];s=(m>>n.fgroup&1);switch(n.ftype){case"block":for(;x<k;++x){t["value"]=x;t["pos"]=1+w.blockwide-k+x;t["active"]=x<=l||p<0;t["first"]=1===x;t["last"]=x===l&&0<p;j(h,t,n.ftype)}continue;case"left":t["value"]=n.fpos;t["active"]=n.fpos<x;break;case"right":t["value"]=l-w.rights+n.fpos;t["active"]=k<=t["value"];break;case"first":t["value"]=1;t["active"]=s&&1<v;break;case"prev":t["value"]=Math.max(1,v-1);t["active"]=s&&1<v;break;case"last":if((t["active"]=(p<0))){t["value"]=1+v}else{t["value"]=l;t["active"]=s&&v<l}break;case"next":if((t["active"]=(p<0))){t["value"]=1+v}else{t["value"]=Math.min(1+v,l);t["active"]=s&&v<l}break;case"leap":case"fill":t["pos"]=n.fpos;t["active"]=s;j(h,t,n.ftype);continue}t["pos"]=n.fpos;t["last"]=t["first"]=c;j(h,t,n.ftype)}if(e.length){b("a",e["html"](q)).click(function(i){i["preventDefault"]();var y=this;do{if("a"===y["nodeName"].toLowerCase()){break}}while((y=y["parentNode"]));d["setPage"](b(y).data("page"));if(d.locate){a.location=y["href"]}});d.locate=h["onSelect"].call({"number":p,"lapping":o,"pages":l,"slice":t["slice"],"isFinished":d.isFinished},v);d.isFinished=true}return d}};return d["setNumber"](g)["setOptions"](f)["setPage"]()}}(jQuery,this));
